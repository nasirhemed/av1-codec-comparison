name: AV1 Codec Comparison Continuous Integration

on:
    pull_request:
        branches: [ master ]

jobs:
    setup:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v2
        - uses: actions/setup-python@v2
        with:
            python-version: '3.x'
        - run: sudo apt-get install gcc cmake yasm nasm wget
        - run: pushd rtc-video-quality 
        - run: ./setup.sh && ./setup_aom.sh && ./setup_rav1e.sh
        - run: pip install -r requirements.txt
        - run: wget https://media.xiph.org/video/derf/y4m/claire_qcif-5.994Hz.y4m
        - run: ./generate_data.py --encoders=aom-rt:av1 --out out.txt claire_qcif-5.994Hz.y4m
        - run: mkdir -p testing && ./generate_graphs --out-dir testing out.txt